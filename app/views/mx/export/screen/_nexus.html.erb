#NEXUS<br />
[generated by mx <%= Time.now %>]<br />
[from matrix: <%= @mx.name %> ]  <br />
<br />
Begin taxa;<br />
Dimensions Ntax=<%= @otus.size -%>;<br />
Taxlabels<br />
<% @otus.each do |o| -%>
&nbsp;&nbsp;'<%= o.display_name(:type => :matrix_name) -%>'<br />
<% end -%>
;<br />
end;<br />
<!-- Render the multistate characters -->
Begin characters;<br />
Title Multistate_characters;<br />
Dimensions Nchar=<%= @multistate_characters.size -%>;<br />
Format<br />
&nbsp;&nbsp;datatype = STANDARD  <br />
&nbsp;&nbsp;missing = ?  <br />
&nbsp;&nbsp;symbols = "0 1 2 3 4 5 6 7 8 9 A B C D E F G H I J K L M N P Q R S U V W X Y Z !"; <br />
Charstatelabels<br />
<% @multistate_characters.each_with_index do |chr, i| -%>
&nbsp;&nbsp;<%= "#{i+1} #{chr.display_matrix_name} /" %> <%= chr.chr_states.collect{|cs| "'" + cs.name + "'"}.join(" ") -%>,<br />
<% end %>
;<br />
Matrix  <br />
<%= render(:partial => '/mx/export/matrix_table', :locals => {:otus => @otus, :chrs => @multistate_characters, :codings => @codings_mx, :format => :nexus}) -%><br />
;<br />
end; <br />
<br />

<% if @continuous_characters.size > 0 -%>

<!-- Render the continuous characters multistate characters --><br />
[ Continuous characters block, remove for execution in PAUP*  ]<br />
 <br />
Begin characters;<br />
&nbsp;&nbsp;title continuous_characters;<br />
&nbsp;&nbsp;dimensions nchar=<%= @continuous_characters.size -%>; <br />
&nbsp;&nbsp;format <br />
&nbsp;&nbsp;datatype = CONTINUOUS<br />
&nbsp;&nbsp;gap = - <br />
;<br />
matrix<br />
<%= render(:partial => '/mx/export/matrix_table', :locals => {:otus => @otus, :chrs => @continuous_characters, :codings => @codings_mx, :format => :nexus}) -%>
;<br />
end;<br />
<br />
[ End continuous characters block ]<br />
<br />
<% end -%>
