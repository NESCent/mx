<% one_click_coding = session[:coding_mode] == :one_click %>
<div id='fast_coding_center_content'>
  <div id="fast_coding_mode_selection">
    <%= form_tag set_coding_mode_for_mxes_path, method: :post do %>
      <input type="hidden" name="return_to" value="<%= request.fullpath %>" />
      <input id="fast_coding_mode_checkbox"
        type="checkbox"
        data-ajaxify="onchange"
        data-ajaxify-spinner-target="#fast_coding_center_content"
        name="fast_coding_mode" value="one_click_mode"
        <% if one_click_coding %>
          checked="checked"
        <% end %>
       / >
      <label for='fast_coding_mode_checkbox'> One-Click Coding Mode </label>
    <% end %>
  </div>

  <div id="fast_coding_form" >
    <div><!-- outer containter -->
      <table><!-- chr nav -->
        <tr>
          <td colspan="2" style="padding-left: 15px; background-color: <%= @mode =='row' ? 'rgb(243,243,243)' : 'none' -%>;">
            <% @chrs.each_with_index do |c, i| -%>
              <% coded = Coding.by_chr(c).by_otu(@otu).count  -%>
              <a class="quicknavbox" style="background-color:<%= (c == @chr ? "red" : (coded > 0 ? "green" : "white")) -%>;" title="<%= html_escape(c.display_name) -%>" href="/projects/<%= @proj.id -%>/mxes/<%= @mx.id -%>/code/<%= @mode -%>/<%= @mode == 'row' ? i : @present_position -%>/<%= @otu.id -%>/<%= c.id -%>" id="chr_<%= c.id -%>"></a>
            <% end -%>
          </td>
        </tr>
      </table>

      <table>
        <tr>
          <!-- otu nav -->
          <td style="width: 10px; background-color: <%= @mode =='col' ? 'rgb(243,243,243)' : 'none' -%>;">
            <% @otus.each_with_index do |o, i| -%>
              <% coded = Coding.by_chr(@chr).by_otu(o).count  -%>
              <a  class="quicknavbox" style="background-color:<%= (o == @otu ? "red" : (coded > 0 ? "green" : "white")) -%>;" title="<%= html_escape(o.display_name) -%>" href="/projects/<%= @proj.id -%>/mxes/<%= @mx.id -%>/code/<%= @mode -%>/<%= @mode == 'col' ? i : @present_position -%>/<%= o.id -%>/<%= @chr.id -%>" id="otu_<%= o.id -%>"></a>
            <% end -%>
          </td>

          <td style="width: 430px; margin: 0 10px;">
            <div style='margin: 0 5px;'>
              <div class='t-r'><b>Coding (by <%= @mode == 'col' ? 'character' : 'OTU' %>)</b></div>
              <%=@otu.display_name %> (matrix name: <%= @otu.display_name(:type => :matrix_name) -%>)&nbsp;
              <span class="small_grey">
                id: <%= link_to(@otu.id, :action => 'show', :controller => 'otus', :id => @otu) %>
              </span>
              <br/>
              <em class='small_grey'>for</em>
              <br/>
              <%= @chr.name %>
              <span class="small_grey">
                id: <%= link_to(@chr.id, {:action => 'show', :controller => 'chrs', :id => @chr}, :target => '_blank') -%>
              </span>
            </div>
            <%= form_tag(:url => mxes_coding_path, :html => {:id => 'one_click_form', :name => "myform", "data-ajaxify"=>"submit"} ) do |f| -%>
              <%= hidden_field_tag('id',        @mx.id)  -%>
              <%= hidden_field_tag('otu_id',    @otu.id)  -%>
              <%= hidden_field_tag('position',  @present_position) -%>
              <%= hidden_field_tag('mode',      @mode) -%>
              <%= hidden_field_tag('chr_id',    @chr.id) -%>
              <% if one_click_coding %>
                <%= render :partial => "mxes/code/one_click_form", :f => f %>
              <% else %>
                <%= render :partial => "mxes/code/standard_form", :f => f %>
              <% end %>
            <% end -%> <!-- End of form -->

            <div class="subform box4" >
              <div class="header" > character description </div>
              <div class="content">
                <% if @chr.doc_char_descr.blank? %>
                  <i> none </i>
                <% else %>
                  <%= @chr.doc_char_descr -%>
                <% end %>
              </div>
            </div>
          </td>

          <!-- coding data -->
          <td style="border-left: 1px solid silver;">
            <div class="box4" style="border: none;">
              <div class="header">
                state details and cell tagging
              </div>

              <% if @chr.continuous? -%>
                    Character is continuous.
              <% else -%>

                <% @chr.chr_states.each do |state| -%>
                  <div class="content" style="border-bottom:1px solid silver;">
                    <b><%= state.s_and_m  -%></b>
                    <% if @s = state.coded?(@otu.id) -%>
                    <% if @s.confidence -%><br/>&nbsp;&nbsp; coded with confidence: <span style="color:red;"><%= @s.confidence.display_name -%></span> <% end %>
                    <% end -%>
                    <%= render_figs_for_obj(state, 'thumb') -%>
                  </div>
                <% end -%>

              <% end %>
            </div>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>

